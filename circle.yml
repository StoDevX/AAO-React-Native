---
general:
  branches:
    ignore:
      - gh-pages

machine:
  pre:
    # install rvm
    - brew install gpg
    - gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
    - curl -sSL https://get.rvm.io | bash -s stable --ruby=2.3.3
    - source ~/.rvm/scripts/rvm
    # install nvm
    - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
    - source ~/.nvm/nvm.sh

  xcode:
    version: "8.2"

  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

dependencies:
  override:
    - nvm install 7
    - nvm use 7
    - gem install bundler
    - bundle install --deployment
    - yarn

  cache_directories:
    - ~/.cache/yarn
    - ~/rvm_binaries

compile:
  override:
    - touch .env.js  
    - bundle exec fastlane ios ci_run

test:
  override:
    - yarn run lint
    - yarn run flow -- check
    - yarn run validate-data
    - yarn test -- --runInBand
