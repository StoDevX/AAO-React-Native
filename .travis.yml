language: generic

env:
  global:
    # `match` keychain info â€“ the values don't matter, they're defined
    # here so they're consistent throughout
    - MATCH_KEYCHAIN_NAME=travis-ios-keychain
    - MATCH_KEYCHAIN_PASSWORD=alpine
    # this just gives us a nice label to use
    - ENCRYPTION_LABEL=199c454344e1
    # variables that are used later on
    - PUSH_BRANCH=0
    - CAN_DEPLOY=0
    - USE_EMULATOR=no
    - DEPLOY_KEY=scripts/travisci_deploy_key
    - run_deploy=0

matrix:
  fast_finish: true
  include:
    - os: linux
      dist: trusty
      sudo: false
      language: node_js
      node_js: '7'
      env: [JS=yes]

    - &android-base
      os: linux
      dist: precise
      sudo: required
      language: android
      jdk: oraclejdk8
      env: [ANDROID=yes, CAN_DEPLOY=yes]
      android:
        components:
          - tools
          - platform-tools
          - build-tools-23.0.1
          - build-tools-23.0.2
          - build-tools-25.0.2
          - android-23
          - android-25
          - extra-android-m2repository
          - extra-google-m2repository
          - extra-android-support

    # - <<: *android-base
    #   env: [ANDROID=yes, USE_EMULATOR=yes]
    #   android:
    #     components:
    #       - tools
    #       - platform-tools
    #       - build-tools-23.0.1
    #       - android-23
    #       - extra-android-m2repository
    #       - extra-google-m2repository
    #       - extra-android-support
    #       - sys-img-armeabi-v7a-google_apis-23

    - os: osx
      language: objective-c
      osx_image: xcode8.1
      node_js: '7'
      env: [IOS=yes, CAN_DEPLOY=yes]


# As seen in http://stackoverflow.com/a/31882307/2347774
# Prevent travis from building twice for PRs
branches:
  only:
    - master
    - /^travis/


before_install: bash scripts/travis/before_install.sh

install: bash scripts/travis/install.sh

before_script: bash scripts/travis/before_script.sh

script: bash scripts/travis/script.sh

after_success: bash scripts/travis/after_success.sh

before_cache:
  - rm -f "$HOME/.gradle/caches/modules-2/modules-2.lock"
  - rm -rf "$TMPDIR/jest_preprocess_cache"

cache:
  bundler: true
  directories:
    - $HOME/.gradle
